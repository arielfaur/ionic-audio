function ionAudioTrack(i,n){function o(i,n,o,t){t.hasOwnProgressBar=n.find("ion-audio-progress-bar").length>0}function t(o,t){var r=this,a=function(n,o){n&&n.url&&(n.progress=0,n.status=0,n.duration=-1,o&&void 0!==o.id&&(n.id=o.id),i&&i.add(n,e,null,u,s))},e=function(){o.track.status=0,o.track.progress=0},u=function(i){o.track.status=i},s=function(i,n){o.track.progress=i,o.track.duration=n},c=function(){n.$broadcast("ionic-audio:trackChange",o.track)};this.seekTo=function(n){i.seekTo(n)},this.getTrack=function(){return o.track},this.start=function(){return o.track&&o.track.url?(i.play(o.track.id),r.hasOwnProgressBar||c(),o.track.id):void 0},o.$watch("track",function(n,o){void 0!==n&&(i.stop(),a(n,o))}),o.$on("$destroy",function(){i.destroy()})}return{transclude:!0,template:"<ng-transclude></ng-transclude>",restrict:"E",scope:{track:"="},require:"ionAudioTrack",link:o,controller:["$scope","$element",t]}}function ionAudioProgress(){return{restrict:"E",scope:{track:"="},template:"{{track.progress | time}}"}}function ionAudioProgressBar(i){function n(n,o,t){function r(){n.track.progress=0,n.track.status=0,n.track.duration=-1}var a,e=o.find("input");angular.isDefined(t.displayTime)||(o.find("ion-audio-progress").remove(),o.find("ion-audio-duration").remove()),angular.isDefined(t.displayInfo)||o.find("h2").remove(),angular.isUndefined(n.track)&&(n.track={},a=n.$on("ionic-audio:trackChange",function(i,o){n.track=o}));var u=n.$watch("track.status",function(i){e.prop("disabled",0==i)});n.displayTrackInfo=function(){return{visibility:angular.isDefined(t.displayInfo)&&(n.track.title||n.track.artist)?"visible":"hidden"}},n.sliderRelease=function(){var o=n.track.progress;i.seekTo(o)},n.$on("$destroy",function(){u(),angular.isDefined(a)&&a()}),r()}return{restrict:"E",scope:{track:"="},template:'<h2 class="ion-audio-track-info" ng-style="displayTrackInfo()">{{track.title}} - {{track.artist}}</h2><div class="range"><ion-audio-progress track="track"></ion-audio-progress><input type="range" name="volume" min="0" max="{{track.duration}}" ng-model="track.progress" on-release="sliderRelease()" disabled><ion-audio-duration track="track"></ion-audio-duration></div>',link:n}}function ionAudioPlay(i){function n(n,o,t,r){var a,e,u=0,s=function(){a=!1,o.addClass("ion-play"),o.removeClass("ion-pause"),o.text(t.textPlay)},c=function(){t.textPlay&&t.textPause&&o.text(o.text()==t.textPlay?t.textPause:t.textPlay)},d=function(){o.toggleClass("ion-play ion-pause"),c()};i.on("tap",function(){return e||a?void(e=!1):(0==u&&(a=!0),r.play(),void d())},o),i.on("doubletap",function(){e=!0},o);var l=n.$watch("track.status",function(i){0==i||4==i?s():2==i&&(a=!1),u=i});s(),n.$on("$destroy",function(){l()})}return{restrict:"A",require:"^^ionAudioControls",link:n}}function ionAudioDuration(){return{restrict:"E",scope:{track:"="},template:"{{track.duration | duration}}"}}angular.module("ionic-audio",["ionic"]),angular.module("ionic-audio").filter("time",function(){var i=function(i){return(new Array(2).join("0")+i).slice(-2)};return function(n){n=n||0;var o=parseInt(n);return i(Math.floor(o/60))+":"+i(o%60)}}),angular.module("ionic-audio").filter("duration",["$filter",function(i){return function(n){return n>0?i("time")(n):""}}]),angular.module("ionic-audio").factory("MediaManager",["$interval","$timeout","$window",function(i,n,o){function t(i){if(!(i.id<0)){var n=P.filter(function(n){return n.id==i.id}).pop();return n&&P.splice(n.id,1,i),n}}function r(i,n,o,r,a){return i.url?(angular.extend(i,{onSuccess:n,onError:o,onStatusChange:r,onProgress:a,status:0,duration:-1,progress:0}),t(i)?i.id:(i.id=P.push(i)-1,i.id)):void console.log("ionic-audio: missing track url")}function a(i){if(y){if(y.id==i)return void(y.status==Media.MEDIA_RUNNING?e():d());y.id>-1&&l()}n(function(){c(P[i])},300)}function e(){console.log("ionic-audio: pausing track "+y.title),$.pause(),h()}function u(i){$&&$.seekTo(1e3*i)}function s(){h(),f()}function c(i){y=i,console.log("ionic-audio: playing track "+y.title),$=g(y),$.play(),m()}function d(){console.log("ionic-audio: resuming track "+y.title),$.play(),m()}function l(){$&&(console.log("ionic-audio: stopping track "+y.title),$.stop())}function g(i){return i.url?new Media(i.url,angular.bind(i,p),angular.bind(i,k),angular.bind(i,v)):void console.log("ionic-audio: missing track url")}function f(){angular.isDefined($)&&($.release(),$=void 0,y=void 0)}function p(){h(),f(),angular.isFunction(this.onSuccess)&&this.onSuccess()}function k(){angular.isFunction(this.onError)&&this.onError()}function v(i){this.status=i,angular.isFunction(this.onStatusChange)&&this.onStatusChange(i)}function h(){angular.isDefined(A)&&(i.cancel(A),A=void 0)}function m(){angular.isDefined(A)||y&&(A=i(function(){y.duration<0&&(y.duration=$.getDuration()),$.getCurrentPosition(function(i){i>-1&&(y.progress=i)},function(i){console.log("Error getting pos="+i)}),angular.isFunction(y.onProgress)&&y.onProgress(y.progress,y.duration)},1e3))}var y,$,A,P=[];return o.cordova||o.Media?{add:r,play:a,pause:e,stop:l,seekTo:u,destroy:s}:(console.log("ionic-audio: missing Cordova Media plugin. Have you installed the plugin? \nRun 'ionic plugin add org.apache.cordova.media'"),null)}]),angular.module("ionic-audio").directive("ionAudioTrack",["MediaManager","$rootScope",ionAudioTrack]),angular.module("ionic-audio").directive("ionAudioProgress",ionAudioProgress),angular.module("ionic-audio").directive("ionAudioProgressBar",["MediaManager",ionAudioProgressBar]),angular.module("ionic-audio").directive("ionAudioPlay",["$ionicGesture",ionAudioPlay]),angular.module("ionic-audio").directive("ionAudioDuration",ionAudioDuration),angular.module("ionic-audio").directive("ionAudioControls",function(){function i(i,n){var o,t=n.find("ion-spinner"),r=this;t.addClass("ng-hide"),this.toggleSpinner=function(){t.toggleClass("ng-hide")},this.play=function(){o||r.toggleSpinner(),this.start()};var a=i.$parent.$watch("track.status",function(i){switch(i){case 1:o=!1;break;case 2:o||(r.toggleSpinner(),o=!0);break;case 0:case 4:o=!1}});i.$on("$destroy",function(){a()})}function n(i,n,o,t){t[0].start=t[1].start}return{restrict:"EA",require:["ionAudioControls","^^ionAudioTrack"],controller:["$scope","$element",i],link:n}});